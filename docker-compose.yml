services:
  app:
    container_name: 'portfolio'
    build:
      context: .
      dockerfile: docker/app/Dockerfile
    restart: on-failure:5
    cpus: 0.5
    mem_reservation: 128m
    mem_limit: 256m
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.portfolio.rule=Host(`${DOMAIN_NAME}`)"
      - "traefik.http.routers.portfolio.entrypoints=web,websecure"
      - "traefik.http.routers.portfolio.tls=true"
      - "traefik.http.routers.portfolio.tls.certresolver=cloudflare"
      - "traefik.http.middlewares.portfolio-headers.headers.SSLRedirect=true"
      - "traefik.http.middlewares.portfolio-headers.headers.STSSeconds=31536000"
      - "traefik.http.middlewares.portfolio-headers.headers.browserXSSFilter=true"
      - "traefik.http.middlewares.portfolio-headers.headers.contentTypeNosniff=true"
      - "traefik.docker.network=traefik_external"
    ports:
      - "127.0.0.1:3000:3000"
    expose:
      - 3000
    healthcheck:
      test: ['CMD-SHELL', 'curl -f http://localhost/ || exit 1']
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 5s
    networks:
      - traefik_external

networks:
  traefik_external:
    external: true